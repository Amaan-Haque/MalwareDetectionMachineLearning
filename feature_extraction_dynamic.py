import orjson
import os
import json
import pandas as pd
import time
import numpy as np

start_time = time.time()

dll_list_benign= []
dll_list_malware= []

# = = = = = = = = = = BENIGN = = = = = = = = = =
file_list = open("file_list_benign1.txt", "r").read()
os.chdir("./Dynamic_Analysis_Data_Part1/Benign")

file_list = file_list.split('\n')

# i = 0
for file in file_list:
        # i = i +1
        try:
                content=json.loads(open(file, "rb").read())
                dll_list_benign.append(content["behavior"]["summary"]["dll_loaded"])

        except:
                pass
        # if i > 100:
        #         break
                
dll_list_benign = sum(dll_list_benign, [])
dll_list_benign = [x.lower() for x in dll_list_benign]

# = = = = = = = = = = MALWARE = = = = = = = = = =
os.chdir("../../")
file_list = open("file_list_malware1.txt", "r").read()
os.chdir("./Dynamic_Analysis_Data_Part1/Malware")

file_list = file_list.split('\n')

# i = 0
for file in file_list:
        # i = i +1
        try:
                content=json.loads(open(file, "rb").read())
                dll_list_malware.append(content["behavior"]["summary"]["dll_loaded"])

        except:
                pass
        # if i > 100:
        #         break
                
dll_list_malware = sum(dll_list_malware, [])
dll_list_malware = [x.lower() for x in dll_list_malware]

# = = = = = = = = = = COMBINED PROCESSING = = = = = = = = = =

counts = dict()

dll_list = dll_list_benign + dll_list_malware
# print(len(np.unique(np.array(dll_list))))
for item in dll_list:
        counts[item] = counts.get(item, 0) +1

counts = sorted(counts.items(), key=lambda x: x[1], reverse=True)
dlls_list_top_100 = print(counts[:100])
print(dlls_list_top_100)

# --------------------------------------------------------------------------------------

# file_list = open("file_list_benign1.txt", "r").read()


# os.chdir("./Dynamic_Analysis_Data_Part1/Benign")

# file_list = file_list.split('\n')

# # i =0
# for file in file_list:
#         # i = i +1
#         try:
#                 content=json.loads(open(file, "rb").read())
#                 hashes_list_benign.append(file)
#                 dll_list_benign.append(content["behavior"]["summary"]["dll_loaded"])

#         except:
#                 # print(file)
#                 pass
#         # if i > 100:
#         #         break
# # print(i)
# counts = dict()

# dll_list_benign = sum(dll_list_benign, [])
# dll_list_benign = [x.lower() for x in dll_list_benign]

# # print(len(np.unique(np.array(dll_list_benign))))
# for item in dll_list_benign:
#         counts[item] = counts.get(item, 0) +1

# counts = sorted(counts.items(), key=lambda x: x[1], reverse=True)
# # #         for it in item:
# print(counts[:100])
# print(time.time() - start_time)
# # # print(list(counts.keys())
# # print(len(list(counts.keys())))

# --------------------------------------------------------------------------------------

# os.chdir("../../")
# file_list = open("file_list_malware1.txt", "r").read()
# tim = time.time()

# os.chdir("./Dynamic_Analysis_Data_Part1/Malware")

# file_list = file_list.split('\n')

# for file in file_list:
#         # i = i +1
#         try:
#                 content=json.loads(open(file, "rb").read())
#                 hashes_list_malware.append(file)
#                 dll_list_malware.append(content["behavior"]["summary"]["dll_loaded"])

#         except:
#                 # print(file)
#                 pass
#         # if i > 100:
#         #         break
# # print(i)
# counts_d = dict()

# dll_list_malware = sum(dll_list_malware, [])
# dll_list_malware = [x.lower() for x in dll_list_malware]

# # print(len(np.unique(np.array(dll_list_benign))))
# for item in dll_list_malware:
#         counts_d[item] = counts_d.get(item, 0) +1

# counts_d = sorted(counts_d.items(), key=lambda x: x[1], reverse=True)

# print(counts_d[0:100])
# print(time.time() - tim)

# --------------------------------------------------------------------------------------
